<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ASLteen üêØ</title>

<!-- TensorFlow + MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/hand-pose-detection"></script>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#0f766e,#1e3a8a);
  color:white;
  text-align:center;
}

header{
  padding:15px;
  position:relative;
}

#mascot{
  position:absolute;
  left:15px;
  top:10px;
  width:90px;
  transition:.3s;
}

#speech{
  background:white;
  color:#0f766e;
  padding:10px;
  border-radius:15px;
  display:inline-block;
  margin-top:10px;
  font-weight:bold;
}

.stats{
  margin-top:10px;
}

.level-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(90px,1fr));
  gap:10px;
  padding:20px;
}

.level{
  background:#2563eb;
  padding:15px;
  border-radius:20px;
  cursor:pointer;
}

.locked{
  background:#555;
  opacity:.4;
  cursor:not-allowed;
}

.card{
  background:white;
  color:#0f766e;
  margin:20px;
  padding:30px;
  border-radius:20px;
  font-size:50px;
}

button{
  background:#ef4444;
  border:none;
  padding:10px 20px;
  border-radius:15px;
  color:white;
  font-size:16px;
  cursor:pointer;
  margin:5px;
}

#hearts{
  font-size:25px;
  color:#ef4444;
}

video{
  width:100%;
  max-width:400px;
  border-radius:20px;
  margin-top:10px;
}

canvas{
  display:none;
}

.progress{
  height:10px;
  background:#1e3a8a;
  margin:10px;
  border-radius:10px;
}

.progress-bar{
  height:100%;
  background:#14b8a6;
  width:0%;
}
</style>
</head>
<body>

<header>
<img id="mascot" src="https://i.imgur.com/VuV3K6F.png">
<h1>ASLteen</h1>
<div id="speech">Ready to train? Let‚Äôs go.</div>
<div class="stats">
XP: <span id="xp">0</span> |
üî• Streak: <span id="streak">0</span>
<div id="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
</div>
<button onclick="toggleMusic()">üéµ Music</button>
</header>

<div class="progress"><div class="progress-bar" id="progressBar"></div></div>

<div class="level-grid" id="levels"></div>

<div id="lessonArea" style="display:none;">
<div class="card" id="cardLetter">A</div>
<button onclick="startCamera()">Start Camera</button>
<video id="video" autoplay playsinline></video>
<button onclick="checkSign()">Check Sign</button>
</div>

<h3>Scan QR to Open</h3>
<canvas id="qr"></canvas>

<audio id="bgMusic" loop>
<source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_115b9b6f18.mp3?filename=relaxing-145038.mp3">
</audio>

<script>

let xp=parseInt(localStorage.getItem("xp"))||0;
let streak=parseInt(localStorage.getItem("streak"))||0;
let lastLogin=localStorage.getItem("lastLogin");
let hearts=5;
let currentLetterIndex=0;
const alphabet=["A","B","C","D","E","F"];

document.getElementById("xp").innerText=xp;
document.getElementById("streak").innerText=streak;

const today=new Date().toDateString();
if(lastLogin!==today){
  streak++;
  localStorage.setItem("streak",streak);
  localStorage.setItem("lastLogin",today);
  document.getElementById("speech").innerText="Consistency! I like it.";
}

const levelsDiv=document.getElementById("levels");
for(let i=1;i<=30;i++){
  let div=document.createElement("div");
  div.className="level";
  if(i>1) div.classList.add("locked");
  div.innerText="Level "+i;
  div.onclick=()=>{ if(i===1) startLevel(); };
  levelsDiv.appendChild(div);
}

function startLevel(){
  document.getElementById("lessonArea").style.display="block";
  updateCard();
}

function updateCard(){
  document.getElementById("cardLetter").innerText=alphabet[currentLetterIndex];
  document.getElementById("progressBar").style.width=
  (currentLetterIndex/alphabet.length)*100+"%";
}

function loseHeart(){
  hearts--;
  document.getElementById("hearts").innerText="‚ù§Ô∏è".repeat(hearts);
  document.getElementById("speech").innerText="Focus. You‚Äôve got this.";
  if(hearts<=0){
    alert("Out of hearts! Restart level.");
    location.reload();
  }
}

function winPoint(){
  xp+=10;
  localStorage.setItem("xp",xp);
  document.getElementById("xp").innerText=xp;
  document.getElementById("speech").innerText="YES! That‚Äôs sharp.";
  currentLetterIndex++;
  if(currentLetterIndex>=alphabet.length){
    document.getElementById("speech").innerText="Level mastered.";
  } else{
    updateCard();
  }
}

function toggleMusic(){
  const m=document.getElementById("bgMusic");
  m.paused?m.play():m.pause();
}

QRCode.toCanvas(document.getElementById('qr'), window.location.href);

let detector;
async function initAI(){
  const model=handPoseDetection.SupportedModels.MediaPipeHands;
  detector=await handPoseDetection.createDetector(model,{
    runtime:'tfjs',
    modelType:'lite'
  });
}
initAI();

async function startCamera(){
  const video=document.getElementById("video");
  const stream=await navigator.mediaDevices.getUserMedia({video:true});
  video.srcObject=stream;
  document.getElementById("speech").innerText="Camera active. Show me the sign.";
}

async function checkSign(){
  const video=document.getElementById("video");
  const hands=await detector.estimateHands(video);
  if(hands.length===0){
    document.getElementById("speech").innerText="I don‚Äôt see your hand.";
    return;
  }

  const letter=alphabet[currentLetterIndex];

  if(letter==="A"){
    winPoint();
  } else if(letter==="B"){
    winPoint();
  } else{
    loseHeart();
  }
}

</script>
</body>
</html>
